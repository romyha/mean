angular.module("loc8rApp",["ngRoute","ngSanitize","ui.bootstrap"]);function config(e,o){e.when("/",{templateUrl:"home/home.view.html",controller:"homeCtrl",controllerAs:"vm"}).when("/about",{templateUrl:"/common/views/genericText.view.html",controller:"aboutCtrl",controllerAs:"vm"}).when("/location/:locationid",{templateUrl:"/locationDetail/locationDetail.view.html",controller:"locationDetailCtrl",controllerAs:"vm"}).when("/register",{templateUrl:"/auth/register/register.view.html",controller:"registerCtrl",controllerAs:"vm"}).when("/login",{templateUrl:"/auth/login/login.view.html",controller:"loginCtrl",controllerAs:"vm"}).otherwise({redirectTo:"/"});o.html5Mode({enabled:false,requireBase:false})}angular.module("loc8rApp").config(["$routeProvider","$locationProvider",config]);(function(){angular.module("loc8rApp").controller("homeCtrl",e);e.$inject=["$scope","loc8rData","geolocation"];function e(e,o,t){var r=this;r.pageHeader={title:"Loc8r",strapline:"Find places to work with wifi near you!"};r.sidebar={content:"Looking for wifi and a seat nearby?"};r.message="Checking your location";r.getData=function(e){var t=e.coords.latitude,n=e.coords.longitude;r.message="Searching for nearby places";o.locationByCoords(t,n).success(function(e){r.message=e.length>0?"":"No locations found.";r.data={locations:e}}).error(function(e){r.message="Sorry, something's gone wrong."})};r.showError=function(o){e.$apply(function(){r.message=o.message})};r.noGeo=function(){e.$apply(function(){r.message="Geolocation not supported by this browser."})};t.getPosition(r.getData,r.showError,r.noGeo)}})();(function(){angular.module("loc8rApp").controller("aboutCtrl",e);function e(){var e=this;e.pageHeader={title:"About Loc8r"};e.main={content:"Loc8r was created to help people find places to sit down and get a bit of work done.\n\nLorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet. Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet."}}})();(function(){angular.module("loc8rApp").controller("reviewModalCtrl",e);e.$inject=["$uibModalInstance","locationData","loc8rData"];function e(e,o,t){var r=this;r.locationData=o;r.onSubmit=function(){r.formError="";if(!r.formData.rating||!r.formData.message){r.formError="All fields required";return false}else{r.doAddReview(r.locationData.locationid,r.formData);return false}};r.doAddReview=function(e,o){t.addReviewById(e,{rating:o.rating,message:o.message}).success(function(e){r.modal.close(e)}).error(function(e){r.formError="Your review has not been saved, try again"});return false};r.modal={cancel:function(){e.dismiss("cancel")},close:function(o){e.close(o)}}}})();(function(){angular.module("loc8rApp").controller("locationDetailCtrl",e);e.$inject=["$routeParams","$location","$uibModal","loc8rData","authentication"];function e(e,o,t,r,n){var a=this;a.locationid=e.locationid;r.locationById(a.locationid).success(function(e){console.log("success");a.data={location:e};a.pageHeader={title:a.data.location.name}}).error(function(e){console.log(e)});a.popupReviewForm=function(){var e=t.open({templateUrl:"/reviewModal/reviewModal.view.html",controller:"reviewModalCtrl as vm",resolve:{locationData:function(){return{locationid:a.locationid,locationName:a.data.location.name}}}});e.result.then(function(e){a.data.location.reviews.push(e)})};a.currentPath=o.path();a.isLoggedIn=n.isLoggedIn()}})();(function(){angular.module("loc8rApp").service("geolocation",e);function e(){var e=function(e,o,t){if(navigator.geolocation){navigator.geolocation.getCurrentPosition(e,o)}else{t()}};return{getPosition:e}}})();(function(){angular.module("loc8rApp").service("loc8rData",e);e.$inject=["$http","authentication"];function e(e,o){var t=function(o,t){return e.get("/api/locations?lng="+t+"&lat="+o+"&maxDistance=200000000")};var r=function(o){return e.get("/api/locations/"+o)};var n=function(t,r){return e.post("/api/locations/"+t+"/reviews",r,{headers:{Authorization:"Bearer "+o.getToken()}})};return{locationByCoords:t,locationById:r,addReviewById:n}}})();(function(){angular.module("loc8rApp").service("authentication",e);e.$inject=["$window","$http"];function e(e,o){var t=function(o){e.localStorage["loc8r-token"]=o};var r=function(){return e.localStorage["loc8r-token"]};var n=function(){var o=r();if(o){var t=JSON.parse(e.atob(o.split(".")[1]));return t.exp>Date.now()/1e3}else return false};var a=function(){if(n()){var o=r();var t=JSON.parse(e.atob(o.split(".")[1]));return{email:t.email,name:t.name}}};register=function(e){return o.post("/api/register",e).success(function(e){t(e.token)})};login=function(e){return o.post("/api/login",e).success(function(e){t(e.token)})};logout=function(){e.localStorage.removeItem("loc8r-token")};return{saveToken:t,getToken:r,isLoggedIn:n,currentUser:a,login:login,register:register,logout:logout}}})();(function(){angular.module("loc8rApp").filter("formatDistance",e);function e(){return function(e){var o,t;if(e>1e3){o=parseFloat(e/1e3).toFixed(1);t=" km"}else{o=parseInt(e);t=" m"}return o+t}}})();(function(){angular.module("loc8rApp").directive("ratingStars",e);function e(){return{restrict:"EA",scope:{thisRating:"=rating"},templateUrl:"/common/directives/ratingStars/ratingStars.template.html"}}})();(function(){angular.module("loc8rApp").directive("footerGeneric",e);function e(){return{restrict:"EA",templateUrl:"/common/directives/footerGeneric/footerGeneric.template.html"}}})();(function(){angular.module("loc8rApp").directive("navigation",e);function e(){return{restrict:"EA",templateUrl:"/common/directives/navigation/navigation.template.html",controller:"navigationCtrl as navvm"}}})();(function(){angular.module("loc8rApp").controller("navigationCtrl",e);e.$inject=["$location","authentication","$route"];function e(e,o,t){var r=this;r.currentPath=e.path();r.isLoggedIn=o.isLoggedIn();r.currentUser=o.currentUser();r.logout=function(){o.logout();e.path("#/")}}})();(function(){angular.module("loc8rApp").directive("pageHeader",e);function e(){return{restrict:"EA",scope:{content:"=content"},templateUrl:"/common/directives/pageHeader/pageHeader.template.html"}}})();(function(){angular.module("loc8rApp").filter("addHtmlLineBreaks",e);function e(){return function(e){if(e){var o=e.replace(/\n/g,"<br/>");return o}else return}}})();(function(){angular.module("loc8rApp").controller("registerCtrl",e);e.$inject=["$location","authentication"];function e(e,o){var t=this;t.pageHeader={title:"Create a new Loc8r account"};t.credentials={name:"",email:"",password:""};t.returnPage=e.search().page||"/";t.onSubmit=function(){t.formError="";if(!t.credentials.name||!t.credentials.email||!t.credentials.password){t.formError="All fields required, please try again";return false}else{t.doRegister()}};t.doRegister=function(){t.formError="";o.register(t.credentials).error(function(e){t.formError=e}).then(function(){e.search("page",null);e.path(t.returnPage)})}}})();(function(){angular.module("loc8rApp").controller("loginCtrl",e);e.$inject=["$location","authentication"];function e(e,o){var t=this;t.pageHeader={title:"Log in to Loc8r"};t.credentials={email:"",password:""};t.returnPage=e.search().page||"/";t.onSubmit=function(){t.formError="";if(!t.credentials.email||!t.credentials.password){t.formError="All fields required, please try again";return false}else{t.doLogin()}};t.doLogin=function(){t.formError="";o.login(t.credentials).error(function(e){t.formError=e}).then(function(){e.search("page",null);e.path(t.returnPage)})}}})();